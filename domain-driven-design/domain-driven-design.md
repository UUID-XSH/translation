# 领域驱动设计

## 关于领域驱动设计

这篇文章参考自Eric Evans《领域驱动设计》一书以及Jimmy Nilsson《以C# .NET为例运用领域驱动设计和模式》，二者详细描述了领域驱动设计的核心概念、技术和模式。在某些情况下，直接使用这些书的措辞是有意义的，并且我认为Eric Evans和Jimmy Nilsson也允许我们这么做。

尽管将模式本身呈现出来是很有用的,但是仅仅对模式进行描述，DDD的许多微妙之处就会消失。这些模式应该是你的工具，而不是你束缚你的规则。它们是为设计而生的语言，在团队内沟通创意和模型十分有益。更为重要的是，记住实践DDD的目的是为了做出更加务实的决定。不要试图将一个模式强加于一个模型。另外，如果你“违背”了一个模式，确保你已经理解了这么做的理由，并将其与其他人沟通。

通常认为，DDD在面向对象范式下表现良好，但远不止这些。DDD挑战了如何去理解问题空间，甚至让这些理解变得可交流。

值得注意的是，DDD还鼓励将其他领域的概念纳入其中，比如测试驱动开发，使用设计模式，以及持续重构。

## 代表模型

领域驱动设计的最主要目的是为了设计和创造出富有表达力的模型。同样，DDD也致力于创造出让参与到软件开发中的各方都能理解的模型。

由于非技术人员同样需要使用这些模型工作，所以如果能用不同的方式进行表达将变得极为便利。典型的，描述一个领域模型的方式有多种，UML草图，代码以及领域语言。

### 使用语言

正在考虑参加培训课程的人会根据主题、成本、以及课程安排搜索课程表。当一个课程被订阅后，一个注册邀请会被下发给订阅人，订阅人可以在稍后选择取消或者接受。

### 使用代码

```
class Person {
    public Registration bookCourse(Course c) { ... } 
}
abstract class Registration { 
    public abstract void accept();
    public abstract void cancel(); 
}
class ReservedRegistration extends Registration { ... } 
class AcceptedRegistration extends Registration { ... }
interface CourseRepository {
public List<Course> find(...); }
```

### 使用ULM草图

## 通用语言

一致地使用通用语言对理解和传达在领域中发现的内涵信息至关重要。在领域驱动开发中，我们通常讨论的是概念而非名词或者动词。概念的意图，其意义和价值对于理解和传达信息至关重要。如何去实现这种意图虽然很重要，但是对于每个意图来说，其实现有很多种。为了理解和分享这些意图，任何人必须在任何地方和任何机会下使用这些语言。当你使用通用语言时，和领域专家的合作将变得更加富有创意和价值。

注意，由于语言中的技术和业务障碍，领域专家可能会隐藏或者模糊重要概念。通常这些术语和实现有关而非领域概念。DDD虽然不会排除实现，但是它从更高的层次去反应模型的用途。

考虑下面的描述:

当一个人订阅了一个课程，如果课程已经满员，那么这个人会得到一个“等待”的状态。一旦课程还有名额可用，那么我们的消息总线必须给这个人发送详细信息以使得支付网关继续处理。

以上描述有一些潜在的障碍。这些术语不会增加价值，但是它们是深入挖掘领域驱动设计的极好线索。

用户有一个状态

状态可能是一个标志或者字段。也许领域专家对其他系统如电子表格很熟悉，并建议使用同样的实现。

通过我们的消息总线发送

这是一个技术实现。实际上在领域中，通过我们的消息总线发送信息没有任何后果。

处理

这是模棱两可并且迷糊，处理过程中会发生什么？

支付网关

另一个实现。实际上此处更为重要的是支付的一些方式而不是支付的实现。

## 策略设计

策略设计讨论的是大而复杂的设计，重点是构成大型模型的许多部分，以及这些部分之间如何相互关联。这有利于设计向前推进，取得足够的进展，而不是掉进“我的模型被强制转化成石头”这一陷阱。

在DDD，这些小的模型存在于上下文的边界，这些有界上下文相互关联的方式称为上下文映射。

### 上下文边界

对于每一个模型，应该有意和明确地去定义其所处的上下文。创建上下文并没有特定的规则，但是让每个人都能理解上下文的边界条件是很重要的。

一个系统下的各个团队如果对于不同的上下文



